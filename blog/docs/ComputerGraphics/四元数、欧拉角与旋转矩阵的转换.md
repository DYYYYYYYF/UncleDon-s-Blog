注：定义四元数为Vector(w, x, y, z)

# 四元数转旋转矩阵：

Hamilton和JPL这两种表达，基本上就是相差一个符号的正负（矩阵上是转置）。

### Hamilton：右手系

$ij=k, i^2 + j^2 + k^2 = ijk = -1$
$$
R_{Ham}=\begin{bmatrix}   
1-2q_2^2-2q_3^2 & 2q_1q_2 - 2q_0q_3 & 2q_1q_3 + 2q_0q_2 \\  
2q_1q_2 + 2q_0q_3 & 1 - 2q_1^2 - 2q_3^2 & 2q_2q_3 - 2q_0q_1 \\ 
2q_1q_3 - 2q_0q_2 & 2q_2q_3 + 2q_0q_1 & 1 - 2q_1^2 - 2q_2^2 \\  
\end{bmatrix}
$$



### JPL：左手系

$ij=-k,ijk=1$
$$
R_{Ham}=\begin{bmatrix}   
1-2q_2^2-2q_3^2 & 2q_1q_2 + 2q_0q_3 & 2q_1q_3 - 2q_0q_2 \\  
2q_1q_2 - 2q_0q_3 & 1 - 2q_1^2 - 2q_3^2 & 2q_2q_3 + 2q_0q_1 \\ 
2q_1q_3 + 2q_0q_2 & 2q_2q_3 - 2q_0q_1& 1 - 2q_1^2 - 2q_2^2 \\  
\end{bmatrix}
$$

# 旋转矩阵转四元数

### Hamilton：

$$
w = \frac{1}{2}\sqrt{1 + r_{11} + r_{22} + r_{33}}\\
x = \frac{r_{32} - r_{23}}{4w}\\
y = \frac{r_{13} - r_{31}}{4w}\\
z = \frac{r_{21} - r_{12}}{4w}
$$



### JPL：

$$
w = \frac{1}{2}\sqrt{1 + r_{11} + r_{22} + r_{33}}\\
x = \frac{r_{23} - r_{32}}{4w}\\
y = \frac{r_{31} - r_{13}}{4w}\\
z = \frac{r_{12} - r_{21}}{4w}
$$



# 四元数转欧拉角：

$$
\begin{bmatrix} \Phi \\ \Theta \\ \psi \end{bmatrix}=
\begin{bmatrix}
atan2(2(q_0q_1 + q_2q_3), 1 - 2(q_1^2 + q_2^2))\\
asin(2(q_0q_2 - q_3q_1))	\\
atan2(2(q_0q_3 + q_1q_2), 1 - 2(q_2^2 + q_3^2))
\end{bmatrix}
$$

